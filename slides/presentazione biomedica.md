#   Biomedical informatics project 
#   Web-Index Group
##  Vagnarelli Sara                                          


#Functional scheme



![schema funzionale](SchemaIO1.png "schema funzionale")









__________________________________________________________________________________________________________________





## TARGETS

 
-Optimization of the code

-server Python 


____________________________________________________________________________________________________________________





## REALIZATION



#### -optimization of the code in order to manage the 3D input pointa

[andrea patrizio](https://github.com/cvdlab-bio/webindex/blob/patrizio_dev_branch/FinalProject/final_project.md)


#### -implementation of a server web with Python 


  


_______________________________________________________________________________________________________________________




## KNOWLEDGES REQUESTED  

* database mongoDB
* file json 
* Python language





## 1. **CODE OPTIMIZATION**

**first code-optimization with "cleaner.py"**

    from time import time
    WIDTH = 800
    HEIGHT = 800
    DEPTH = 1024
    SOURCE = 'bone0.txt'
    DESTINATION = 'bone_clean.txt'
    points_counter = 0

    def clean(down, middle, up):
     global points_counter
     middle_clean = []
     middle_clean.append(middle[0])
    
     for x in range(WIDTH):
        if (middle[0][x] == '1'):
                points_counter += 1
    
     for y in range(1, HEIGHT-1):
        row = []
        row.append(middle[y][0])        
        if (row[0] == '1'):
                points_counter += 1
        
        for x in range(1, WIDTH-1):
            if (middle[y][x] == '1'):
                if (middle[y-1][x] == '1' and
                    middle[y+1][x] == '1' and
                    middle[y][x-1] == '1' and
                    middle[y][x+1] == '1' and
                    up[y][x] == '1' and
                    down[y][x] == '1'):
                    row.append('0')
                else:
                    row.append('1')
            else:
                row.append('0')                
            if (row[x] == '1'):
                points_counter += 1
                
        row.append(middle[y][WIDTH-1])
        if (row[WIDTH-1] == '1'):
                points_counter += 1
                
        middle_clean.append(row)
        
     middle_clean.append(middle[HEIGHT-1])
     for x in range(WIDTH):
         if (middle[HEIGHT-1][x] == '1'):
                 points_counter += 1
                
     return middle_clean

    def loadSlice(input):
     slice = []
     input.readline()
     for y in range(HEIGHT):
        slice.append(input.readline())
     return slice


'''in order to know which slide is..you must skip the comment on the reading'''
  
    def writeSlice(output, slice, id):
     output.write('# New slice (' + str(id) + ')\n')
     for y in range(HEIGHT):
        row = ""
        for x in range(WIDTH):
            row += slice[y][x]
        output.write(row + '\n')

    def addPoints(slice):
     global points_counter
     for row in slice:
        for x in row:
            if (x == '1'):
                points_counter += 1

    print "START!"
    start_time = time()

    input = open(SOURCE, 'r')
    output = open(DESTINATION, 'w')


'''split the cube into slices and take three slices at time. Keep the highest and the lowest.'''




    down = loadSlice(input)
    middle = loadSlice(input)
    up = loadSlice(input)
    writeSlice(output, down, 0)
    '''quanti punti ho in una slice'''
    addPoints(down)
    print "clean 0"
    '''cancella i punti inerni nella middle

    '''scrive solo middle'''
    writeSlice(output, clean(down, middle, up), 1)
    print "clean 1"

    '''carico le nuove slice'''
    for z in range(2, DEPTH-1):
     down = middle
     middle = up
     up = loadSlice(input)
     writeSlice(output, clean(down, middle, up), z)
     print "clean", z

    
    
'''we've reached the last one , take "up" that you don't have to optimize and write it.
    
    
    
    
    writeSlice(output, up, DEPTH-1)
    addPoints(up)
    print "clean 1023"

    input.close()
    output.close()

    print "number of points:", points_counter

    execution_time = time() - start_time
    if (execution_time >= 3600):
      print "\nTime: ", "%02d" % (execution_time/3600), ".", "%02d" % ((execution_time%3600)/60), " h"
    elif (execution_time >= 60):
     print "\nTime: ", "%02d" % (execution_time/60), ".", "%02d" % (execution_time%60), " m"
    else:
     print "\nTime: ", "%02d" % (execution_time), " s"
    print "FINISH!"
    
    
    
    
    
    
**input after cleaner.py**

    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000
    00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    00000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000
    ....................












**second optimization with "optimizer.py"**




'''reformat the file so that it can take less memory.. saving only the positions of the "1" '''

    from time import time

    WIDTH = 800
    HEIGHT = 800
    DEPTH = 1024
    SOURCE = 'bone_clean.txt'
    DESTINATION = 'bone_op.txt'

    start_time = time()
    input = open(SOURCE, 'r')
    output = open(DESTINATION, 'w')
    points = 0

    for z in range(DEPTH):
     output.write(input.readline())
     for y in range(HEIGHT):
        input_row = input.readline()
        output_row = ""
        for x in range(WIDTH):
            if (input_row[x] == '1'):
                output_row += str(x) + " "
                points += 1
        output.write(output_row[:len(output_row)-1] + "\n")

    execution_time = time() - start_time
    if (execution_time >= 60):
      print "\nTime: ", "%02d" % (execution_time/60), ".", "%02d" % (execution_time%60), " m"
    else:
      print "\nTime: ", "%02d" % (execution_time), " s"
    print "number of points:", points





**STATISTICS**

    - number of points

    space 3D: 800 * 800 * 1024   = 655.360.000
    original model 	            	= 87.883.292 (circa 13%)   	circa 40 minuti		640MB		  
    cleaned model		             	= 13.489.345 (circa 2%)     circa 7 minuti	  640MB
    optimized model		            = 13.489.345 	             	circa 2 minuti	  50MB

    




### 2. **SERVER WEB WITH PYTHON**







    
***
